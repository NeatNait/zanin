"use strict";angular.module("zaninApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngTouch","ngAnimate","hmTouchEvents","chartjs-directive","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/splash.html",controller:"SplashCtrl"}).when("/game",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/menu",{templateUrl:"views/menu.html",controller:"MenuCtrl"}).when("/chart",{templateUrl:"views/chart.html",controller:"ChartCtrl"}).when("/records",{templateUrl:"views/records.html",controller:"RecordsCtrl"}).when("/tutorial",{templateUrl:"views/tutorial.html",controller:"TutorialCtrl"}).when("/tutorial",{templateUrl:"views/tutorial.html",controller:"TutorialCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location",function(a,b){a.go=function(c,d){a.side=d,b.path(c)}}]),angular.module("zaninApp").controller("MainCtrl",["$rootScope","$scope","$interval","$timeout","$animate","$location","GameStat","localStorageService",function(a,b,c,d,e,f,g,h){function i(){function a(a,b){return Math.log(b)/Math.log(a)}var c=Math.floor(a(b.baselvl,b.game.points+b.baselvl));c<=b.maxlvl&&(b.level=c)}function j(){b.game.points>u&&(u+=v,m())}function k(){b.warnToChange=w-Math.floor((u-b.game.points)/v*w),b.warnToChange>w&&(b.warnToChange=0)}function l(){d(function(){b.loaded=!0},2e3),q=c(function(){b.timeLeft<=0?(b.timeLeft=0,c.cancel(q),A.fade(1,0,1e3),o(),f.path("/menu")):b.timeLeft-=Math.floor(b.level/b.ratetime)},1e3)}function m(){b.colors.sort(function(){return.5-Math.random()})}function n(){b.gestures=[{g:"tap"},{g:"doubleTap"},{g:"swipeLeft"},{g:"swipeRight"}]}function o(){p(),b.game.end=new Date,b.game.timePlayed=b.game.end-b.game.start,b.game.tapsPerSecond=b.game.taps.globalCount/(b.game.timePlayed/1e3),a.game=b.game;var c=new g;c.user=z,c.data=b.game,c.$save()}function p(){b.game.highestCombo<b.combo&&(b.game.highestCombo=b.combo),b.game.combos.push({combo:b.combo,lost:new Date})}var q,r,s,t,u,v,w,x,y=function(a,b){this.gesture=a,this.color=b},z=h.get("userId");b.path="game";var A=new Howl({urls:["audio/loop.wav"],loop:!0});b.tutorial=!1,b.init=function(){b.game={start:new Date,end:!1,taps:{globalCount:0,red:{count:0,color:"#E74A43"},blue:{count:0,color:"#44C1EB"},yellow:{count:0,color:"#FFC634"},green:{count:0,color:"#33cc99"},misses:{count:0,color:"#4D5360"}},combos:[]},b.loaded=!1,b.firstClick=null,b.gestures=[{g:"tap"},{g:"doubleTap"}],b.actions=[],b.baselvl=2,b.game.points=0,b.timeLeft=0,b.totalTimePlayed=0,b.level=1,b.combo=0,b.game.highestCombo=0,b.maxlvl=20,b.ratePoints=1.2,b.ratetime=.7,b.maxenergy=7,b.energy=0,b.timeincrease=1,b.warnToChange=0,u=300,v=300,w=10,x=400,d(function(){l()},2e3),b.timeLeft=5},b.gameInit=function(){b.colors=[{color:"blue",side:"left"},{color:"red",side:"left"},{color:"green",side:"right"},{color:"yellow",side:"right"}];var a=b.colors[Math.floor(b.colors.length*Math.random())].color,c=b.gestures[1].g,d=new y(c,a);b.actions=[],b.actions.push(d),b.actions.push(b.createRandomAction()),b.actions.push(b.createRandomAction()),b.actions.push(b.createRandomAction())},b.tutorialInit=function(){b.timeLeft=5e3,b.step=1,B(b.step),b.$on("acierto",function(){b.step++,B(b.step)})};var B=function(a){switch(a){case 1:b.colors=[{color:"blue",side:"left",dimmed:!1},{color:"red",side:"left",dimmed:!1},{color:"green",side:"right",dimmed:!1},{color:"yellow",side:"right",dimmed:!1}],d(function(){b.colors=[{color:"blue",side:"left",dimmed:!1},{color:"red",side:"left",dimmed:!0},{color:"green",side:"right",dimmed:!0},{color:"yellow",side:"right",dimmed:!0}]},3500),b.actions.push(new y("doubleTap",b.colors[0].color)),b.actions.push(new y("tap",b.colors[0].color)),b.actions.push(new y("swipeLeft",b.colors[0].color)),b.actions.push(new y("swipeRight",b.colors[0].color)),b.actions.push(new y("tap",b.colors[1].color)),b.actions.push(new y("tap",b.colors[2].color)),b.actions.push(new y("doubleTap",b.colors[3].color)),b.actions.push(new y("swipeLeft",b.colors[0].color)),b.actions.push(new y("swipeRight",b.colors[0].color)),b.instructionText="Double tap blue, seems like a good idea";break;case 2:b.instructionText="Now single tap blue. There will be no return";break;case 3:b.instructionText="Let's try something new. Swipe left over blue";break;case 4:b.instructionText="It's time to swipe right blue. Yep, blue again";break;case 5:b.colors=[{color:"blue",side:"left",dimmed:!0},{color:"red",side:"left",dimmed:!1},{color:"green",side:"right",dimmed:!0},{color:"yellow",side:"right",dimmed:!0}],b.instructionText="And zanin created colors! Tap red";break;case 6:b.colors=[{color:"blue",side:"left",dimmed:!0},{color:"red",side:"left",dimmed:!0},{color:"green",side:"right",dimmed:!1},{color:"yellow",side:"right",dimmed:!0}],b.instructionText="A wild new color appeared! Tap green";break;case 7:b.colors=[{color:"blue",side:"left",dimmed:!0},{color:"red",side:"left",dimmed:!0},{color:"green",side:"right",dimmed:!0},{color:"yellow",side:"right",dimmed:!1}],b.instructionText="Last but not least. Double tap yellow";break;case 8:b.actions=[],b.colors=[{color:"blue",side:"left",dimmed:!0},{color:"red",side:"left",dimmed:!0},{color:"green",side:"right",dimmed:!0},{color:"yellow",side:"right",dimmed:!0}],b.instructionText="Hit every move and you'll gain combo",d(function(){b.instructionText="The higher the combo, the faster you'll gain time"},4e3),d(function(){b.step++,b.instructionText="Those bars show your remaining time. They come to zero and game's over",b.timeLeft=100},9e3),d(function(){b.instructionText="Now it's your time to zanin!",b.step++},16e3),d(function(){b.tutorial=!1,b.gameInit(),b.timeLeft=50,b.step++},19e3);break;default:b.instructionText="Zanin!"}};b.getComboClass=function(){return Math.ceil(b.combo/20)},b.load=function(){b.init(),b.tutorial?b.tutorialInit():b.gameInit()},b.createRandomAction=function(){var a=b.colors[Math.floor(b.colors.length*Math.random())].color,c=b.gestures[Math.floor(b.gestures.length*Math.random())].g;return new y(c,a)},b.aciertos=function(a){b.game.points+=Math.floor(b.ratePoints*b.level),b.timeLeft+=(b.energy+1)*b.timeincrease,b.combo++,b.energy<b.maxenergy&&b.energy++,b.game.taps[a].count++,b.game.taps.globalCount++,b.createNewAction(),k(),i(),j(),b.game.points>x&&n(),b.$broadcast("acierto",a)},b.fallos=function(){p(),b.combo=0,b.energy=0,b.game.taps.misses.count++},b.createNewAction=function(){b.actions.splice(0,1),b.actions.push(b.createRandomAction())};var C,D=function(a){a===b.actions[0].color?(b.aciertos(a),e.addClass(angular.element("."+a),"pushed",function(){e.removeClass(angular.element("."+a),"pushed")})):b.fallos()},E=0;b.checkGesture=function(a,c,d){return b.loaded=!0,"doubleTap"===d&&"tap"===r&&"doubleTap"===b.actions[0].gesture&&(d="tap"),r=b.actions[0].gesture,"tap"===d&&"doubleTap"===b.actions[0].gesture?E?(b.fallos(),void(E=0)):void E++:E&&"doubleTap"!==d?(b.fallos(),void(E=0)):(E=0,b.actions[0].gesture===d?D(c):b.fallos(),s=d,t=c,void(C=a))}}]),angular.module("zaninApp").controller("SplashCtrl",["$scope","$interval","$timeout","$animate","$location","User","localStorageService",function(a,b,c,d,e,f,g){a.path="splash",a.go=function(a){e.path("/"+a)};var h=g.get("userId");if(console.log("userID: "+h),null===h){var i=new f;a.nextView="'tutorial'",i.$save(function(a,b){console.log(a),console.log(b),g.add("userId",a._id)})}else a.nextView="'tutorial'"}]),angular.module("zaninApp").controller("MenuCtrl",["$rootScope","$scope","$interval","$timeout",function(a,b,c,d){a.path="menu",void 0===a.game&&(a.game={}),void 0===a.oldPoints&&(a.oldPoints=0);var e=document.querySelector("#points"),f=new Odometer({el:e,value:a.oldPoints,format:"d"});d(function(){f.update(a.game.points)},4e3),void 0!==a.game&&(a.oldPoints=a.game.points),b.msToTime=function(a){a||(a=0);var b=parseInt(a%1e3/100),c=parseInt(a/1e3%60),d=parseInt(a/6e4%60),e=parseInt(a/36e5%24);return e=10>e?"0"+e:e,d=10>d?"0"+d:d,c=10>c?"0"+c:c,d+"' "+c+"'' "+b+"'''"}}]),angular.module("zaninApp").controller("ChartCtrl",["$rootScope","$scope","$interval","$timeout",function(a,b,c,d){b.path="chart";var e=[],f=a.game.taps;for(var g in f)e.push({value:f[g].count,color:f[g].color});d(function(){b.clicksChart={data:e,options:{}}},1e3)}]),angular.module("zaninApp").controller("RecordsCtrl",["$scope","$rootScope","GameStat","User","localStorageService",function(a,b,c,d,e){b.path="records",c.query({},function(b){a.gameStats=b}),a.user=d.get({userId:e.get("userId")},function(b){a.userName=b.name}),a.updateUser=function(){a.user.name=a.userName,a.user.$update()}}]),angular.module("zaninApp").controller("TutorialCtrl",["$scope","$rootScope",function(a,b){b.path="tutorial"}]),angular.module("zaninApp").factory("GameStat",["$resource",function(a){var b=a("http://gamestats-neatnait.rhcloud.com/api/gamestat/:gameStatId",{gameStatId:"@id"},{charge:{method:"POST",params:{charge:!0}}});return b}]),angular.module("zaninApp").factory("User",["$resource",function(a){var b=a("http://gamestats-neatnait.rhcloud.com/api/user/:userId",{userId:"@_id"},{update:{method:"PUT"}});return b}]);