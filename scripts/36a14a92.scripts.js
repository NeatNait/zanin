"use strict";angular.module("zaninApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngTouch","ngAnimate","hmTouchEvents","chartjs-directive"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/splash.html",controller:"SplashCtrl"}).when("/game",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/menu",{templateUrl:"views/menu.html",controller:"MenuCtrl"}).when("/chart",{templateUrl:"views/chart.html",controller:"ChartCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("zaninApp").controller("MainCtrl",["$rootScope","$scope","$interval","$timeout","$animate","$location",function(a,b,c,d,e,f){function g(){b.colors.sort(function(){return.5-Math.random()})}function h(){c.cancel(k);var a=c(function(){b.createNewAction()},r);return k=a,a}function i(){j(),b.game.end=new Date,b.game.timePlayed=b.game.end-b.game.start,a.game=b.game,console.log(b.game)}function j(){b.game.highestCombo<b.combo&&(b.game.highestCombo=b.combo),b.game.combos.push({combo:b.combo,lost:new Date})}var k,l,m,n,o,p,q=function(a,b){this.gesture=a,this.color=b},r=5e3;b.path="game",b.init=function(){b.game={start:new Date,end:!1,taps:{red:{count:0,color:"#E74A43"},blue:{count:0,color:"#44C1EB"},yellow:{count:0,color:"#FFC634"},green:{count:0,color:"#33cc99"},misses:{count:0,color:"#4D5360"}},combos:[]},b.colors=[{color:"blue",side:"left"},{color:"red",side:"left"},{color:"green",side:"right"},{color:"yellow",side:"right"}],b.firstClick=null,b.gestures=[{g:"tap"},{g:"doubleTap"}],b.actions=[],b.game.points=0,b.timeLeft=5,b.totalTimePlayed=0,b.level=1,b.combo=0,b.game.highestCombo=0,b.maxlvl=20,b.baselvl=2,b.ratePoints=1.2,b.ratetime=.7,b.game.points=b.baselvl,b.maxenergy=7,b.energy=0,b.timeincrease=1,o=300,p=300,b.actions.push(b.createRandomAction()),b.actions.push(b.createRandomAction()),b.actions.push(b.createRandomAction()),b.actions.push(b.createRandomAction())},b.getComboClass=function(){return Math.ceil(b.combo/20)},b.load=function(){b.init()},l=c(function(){function a(a,b){return Math.log(b)/Math.log(a)}var d=Math.floor(a(b.baselvl,b.game.points));d<=b.maxlvl&&(b.level=d),b.game.points>o&&(o+=p,g()),b.timeLeft<=0?(b.lvl="GAME OVER",b.level="GAME OVER",b.timeLeft=0,c.cancel(l),i(),f.path("/menu")):b.timeLeft-=Math.floor(b.level/b.ratetime)},1e3),c(function(){b.gestures=[{g:"tap"},{g:"doubleTap"},{g:"swipeLeft"},{g:"swipeRight"}]},2e4),b.createRandomAction=function(){var a=b.colors[Math.floor(b.colors.length*Math.random())].color,c=b.gestures[Math.floor(b.gestures.length*Math.random())].g;return new q(c,a)},b.aciertos=function(a){b.game.points+=Math.floor(b.ratePoints*b.level),b.timeLeft+=(b.energy+1)*b.timeincrease,b.combo++,b.energy<b.maxenergy&&b.energy++,b.game.taps[a].count++,b.createNewAction()},b.fallos=function(){j(),b.combo=0,b.energy=0,b.game.taps.misses.count++},b.createNewAction=function(){b.actions.splice(0,1),b.actions.push(b.createRandomAction())};var s,t=function(a){a===b.actions[0].color?(b.aciertos(a),h(),e.addClass(angular.element("."+a),"pushed",function(){e.removeClass(angular.element("."+a),"pushed")})):b.fallos()},u=0;b.checkGesture=function(a,c,d){return"tap"===d&&"doubleTap"===b.actions[0].gesture?u?(b.fallos(),void(u=0)):void u++:u&&"doubleTap"!==d?(b.fallos(),void(u=0)):(u=0,b.actions[0].gesture===d?t(c):b.fallos(),m=d,n=c,void(s=a))}}]),angular.module("zaninApp").controller("SplashCtrl",["$scope","$interval","$timeout","$animate","$location",function(a,b,c,d,e){a.path="splash",a.go=function(a){e.path("/"+a)}}]),angular.module("zaninApp").controller("MenuCtrl",["$rootScope","$scope","$interval","$timeout","$animate","$location",function(a,b,c,d,e,f){b.path="menu",b.go=function(a){f.path(a)},void 0===a.game&&(a.game={}),void 0===a.oldPoints&&(a.oldPoints=0);var g=document.querySelector("#points"),h=new Odometer({el:g,value:a.oldPoints,format:"d"});d(function(){h.update(a.game.points)},2e3),void 0!==a.game&&(a.oldPoints=a.game.points),b.msToTime=function(a){var b=parseInt(a%1e3/100),c=parseInt(a/1e3%60),d=parseInt(a/6e4%60),e=parseInt(a/36e5%24);return e=10>e?"0"+e:e,d=10>d?"0"+d:d,c=10>c?"0"+c:c,d+"' "+c+"'' "+b+"'''"}}]),angular.module("zaninApp").controller("ChartCtrl",["$rootScope","$scope","$interval","$timeout","$animate","$location",function(a,b,c,d,e,f){b.path="chart",b.go=function(a){f.path(a)};var g=[],h=a.game.taps;for(var i in h)g.push({value:h[i].count,color:h[i].color});d(function(){b.clicksChart={data:g,options:{}}},1e3)}]);